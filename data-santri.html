<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Data Santri</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <nav class="topbar">
  <div class="topbar-left">
    <img src="img/igg.png" alt="Logo WOSAE">
    <div class="topbar-title">WOSAE - Dashboard</div>
  </div>
  <div class="topbar-toggle" onclick="toggleNav()">â˜°</div>
  <div class="topbar-links" id="topbarLinks">
    <a href="dashboard.html" class="nav-item">Beranda</a>
    <div class="dropdown">
      <a href="#">Divisi â–¼</a>
      <div class="dropdown-content">
        <a href="divisi.html">Semua Divisi</a>
        <a href="divisi-dekorasi.html">Dekorasi</a>
        <a href="divisi-acara.html">Acara</a>
        <a href="divisi-perkap.html">Perkap</a>
        <a href="divisi-konsumsi.html">Konsumsi</a>
      </div>
    </div>
    <a href="data-santri.html" class="nav-item">Data Santri</a>
    <a href="brosur.html" class="nav-item">Brosur</a>
    <a href="log.html" class="nav-item">Log</a>
    <a href="index.html" class="logout" onclick="logout()">Logout</a>
    <button class="dark-mode-toggle" onclick="toggleDarkMode()">ðŸŒ“ Mode</button>
  </div>
</nav>
<header>
    <h2>Data Santri WOSAE</h2>
  </header>
  <main>
    <form id="formSantri">
      <input type="text" id="nama" placeholder="Nama Santri" required>
      <input type="text" id="asal" placeholder="Asal Sekolah" required>
      <input type="text" id="alamat" placeholder="Alamat" required>
      <input type="text" id="hp" placeholder="Nomor HP" required>
      <select id="status">
        <option value="Belum Lunas">Belum Lunas</option>
        <option value="Lunas">Lunas</option>
      </select>
      <button type="submit">Tambah Santri</button>
    </form>

    <input type="text" id="searchInput" placeholder="Cari nama santri...">
    <button id="exportBtn">Ekspor ke Excel</button>

    <table>
      <thead>
        <tr>
          <th>Nama</th>
          <th>Asal Sekolah</th>
          <th>Alamat</th>
          <th>No HP</th>
          <th>Status</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody id="tabelSantri">
        <!-- Data santri ditambahkan di sini -->
      </tbody>
    </table>
  </main>

  <script>
     function toggleNav() {
    document.getElementById('topbarLinks').classList.toggle('show');
  }

  const links = document.querySelectorAll(".nav-item");
  links.forEach(link => {
    if (link.href === window.location.href) {
      link.classList.add("active");
    }
  });

  const savedTheme = localStorage.getItem('theme');
  if (savedTheme === 'dark') document.body.classList.add('dark');

  function toggleDarkMode() {
    document.body.classList.toggle('dark');
    const newTheme = document.body.classList.contains('dark') ? 'dark' : 'light';
    localStorage.setItem('theme', newTheme);
  }
    const form = document.getElementById("formSantri");
    const tabelSantri = document.getElementById("tabelSantri");
    const searchInput = document.getElementById("searchInput");
    const exportBtn = document.getElementById("exportBtn");

    let santriList = JSON.parse(localStorage.getItem("santriList")) || [];

    function renderTable(filter = "") {
      tabelSantri.innerHTML = "";
      santriList.forEach((s, i) => {
        if (s.nama.toLowerCase().includes(filter.toLowerCase())) {
          const row = `
            <tr>
              <td contenteditable="true" onblur="editField(${i}, 'nama', this.innerText)">${s.nama}</td>
              <td contenteditable="true" onblur="editField(${i}, 'asal', this.innerText)">${s.asal}</td>
              <td contenteditable="true" onblur="editField(${i}, 'alamat', this.innerText)">${s.alamat}</td>
              <td contenteditable="true" onblur="editField(${i}, 'hp', this.innerText)">${s.hp}</td>
              <td>
                <select onchange="updateStatus(${i}, this.value)">
                  <option value="Belum Lunas" ${s.status === "Belum Lunas" ? "selected" : ""}>Belum Lunas</option>
                  <option value="Lunas" ${s.status === "Lunas" ? "selected" : ""}>Lunas</option>
                </select>
              </td>
              <td class="actions">
                <button onclick="hapusSantri(${i})">Hapus</button>
              </td>
            </tr>
          `;
          tabelSantri.innerHTML += row;
        }
      });
    }

    function hapusSantri(index) {
      santriList.splice(index, 1);
      simpanData();
    }

    function updateStatus(index, newStatus) {
      santriList[index].status = newStatus;
      simpanData();
    }

    function editField(index, field, value) {
      santriList[index][field] = value;
      simpanData();
    }

    function simpanData() {
      localStorage.setItem("santriList", JSON.stringify(santriList));
      renderTable(searchInput.value);
    }

    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const santri = {
        nama: document.getElementById("nama").value,
        asal: document.getElementById("asal").value,
        alamat: document.getElementById("alamat").value,
        hp: document.getElementById("hp").value,
        status: document.getElementById("status").value
      };
      santriList.push(santri);
      simpanData();
      form.reset();
    });

    searchInput.addEventListener("input", () => {
      renderTable(searchInput.value);
    });

    exportBtn.addEventListener("click", () => {
      import('https://cdn.sheetjs.com/xlsx-0.20.0/package/xlsx.mjs').then(XLSX => {
        const headers = ["Nama", "Asal Sekolah", "Alamat", "No HP", "Status"];
        const data = santriList.map(s => [s.nama, s.asal, s.alamat, s.hp, s.status]);
        data.unshift(headers);

        const worksheet = XLSX.utils.aoa_to_sheet(data);
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, "Data Santri");

        const wbout = XLSX.write(workbook, { bookType: "xlsx", type: "array" });
        const blob = new Blob([wbout], { type: "application/octet-stream" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "data-santri.xlsx";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      });
    });

      let csvRows = [];
      for (let i = 0; i < headers.length; i++) {
        let row = [headers[i], ...columns[i]].join(",");
        csvRows.push(row);
      }

      const csvContent = csvRows.join("\n");
      const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
      const link = document.createElement("a");
      link.setAttribute("href", URL.createObjectURL(blob));
      link.setAttribute("download", "data-santri.csv");
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);

    renderTable();
  </script>
</body>
</html>